<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ê–Ω–æ–Ω–∏–º–Ω–∞—è –æ—Ç–∫—Ä—ã—Ç–∫–∞</title>

<style>

html, body {
    height: 100%;
}
body {
    margin: 0;
    padding: 0;
    font-family: Arial, sans-serif;
    text-align: center;
    color: white;
    overflow: hidden;

    background:
        repeating-linear-gradient(
            190deg,
            rgba(255, 182, 193, 0.5) 40px,
            rgba(255, 105, 180, 0.5) 80px,
            rgba(255, 20, 147, 0.5) 120px,
            rgba(219, 112, 147, 0.5) 160px,
            rgba(199, 21, 133, 0.5) 200px,
            rgba(218, 112, 214, 0.5) 240px,
            rgba(255, 182, 193, 0.5) 280px,
            rgba(255, 105, 180, 0.5) 300px
        ),
        repeating-linear-gradient(
            -190deg,
            rgba(255, 182, 193, 0.5) 30px,
            rgba(255, 105, 180, 0.5) 60px,
            rgba(255, 20, 147, 0.5) 90px,
            rgba(219, 112, 147, 0.5) 120px,
            rgba(199, 21, 133, 0.5) 150px,
            rgba(218, 112, 214, 0.5) 180px,
            rgba(255, 182, 193, 0.5) 210px,
            rgba(255, 105, 180, 0.5) 230px
        ),
        repeating-linear-gradient(
            23deg,
            rgba(255, 182, 193, 0.5) 50px,
            rgba(255, 105, 180, 0.5) 100px,
            rgba(255, 20, 147, 0.5) 150px,
            rgba(219, 112, 147, 0.5) 200px,
            rgba(199, 21, 133, 0.5) 250px,
            rgba(218, 112, 214, 0.5) 300px,
            rgba(255, 182, 193, 0.5) 350px,
            rgba(255, 105, 180, 0.5) 370px
        ) no-repeat;
}


/* –ê–Ω—Ç–∏-–±—ç–Ω–¥–∏–Ω–≥: —Ç–æ–Ω–∫–∏–π —à—É–º */
body::after {
    content: "";
    position: fixed;
    inset: 0;
    pointer-events: none;
    opacity: 0.04;
    background-image:
        repeating-linear-gradient(
            0deg,
            rgba(0,0,0,0.04) 0px,
            rgba(0,0,0,0.04) 1px,
            transparent 1px,
            transparent 3px
        );
}

.container {
    margin-top: 40px;
}

h1 {
    font-size: 36px;
    text-shadow: 2px 2px 6px rgba(0,0,0,0.3);
}

.gif {
    width: 260px;
    border-radius: 20px;
    margin: 20px 0;
}

/* –ø—Ä—ã–∂–æ–∫ */
.jumpLoop {
    animation: jumpAnim 0.7s ease-in-out infinite;
}

@keyframes jumpAnim {
    0% { transform: translateY(0); }
    40% { transform: translateY(-70px); }
    70% { transform: translateY(-35px); }
    100% { transform: translateY(0); }
}
    
@keyframes pulse {
    0% { transform: translate(-50%, -50%) scale(1); }
    50% { transform: translate(-50%, -50%) scale(1.2); }
    100% { transform: translate(-50%, -50%) scale(1); }
}


.buttons {
    margin-top: 20px;
}

button {
    font-size: 20px;
    padding: 15px 25px;
    margin: 10px;
    border: none;
    border-radius: 12px;
    cursor: pointer;
}

#yesBtn {
    background: #28d17c;
    color: white;
    font-size: 25px; /* –Ω–∞—á–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä */
}

#noBtn {
    background: #444;
    color: white;
    font-size: 10px; /* –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –º–µ–Ω—å—à–µ */
}

/* —Å–æ–æ–±—â–µ–Ω–∏–µ */
#message {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 42px;
    color: #b3002d;

    background: rgba(255,255,255,0.78); /* ‚Üê –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å */
    
    padding: 35px 45px;
    border-radius: 20px;
    z-index: 1000;
    box-shadow: 0 0 40px rgba(0,0,0,0.3);

    backdrop-filter: blur(6px); /* –∫—Ä–∞—Å–∏–≤—ã–π —Å—Ç–µ–∫–ª—è–Ω–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç */
}


/* –±–æ–ª—å—à–æ–µ —Å–µ—Ä–¥—Ü–µ */
#bigHeart {
    display: none;
    position: fixed;
    top: 80%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 320px;
    z-index: 900;
    animation: spinHeart 4s linear infinite;
    filter: drop-shadow(0 0 35px rgba(255,0,0,0.7));
    pointer-events: auto;   /* ‚Üê –í–ê–ñ–ù–û */
    cursor: pointer;        /* ‚Üê —á—Ç–æ–±—ã –≤–∏–¥–Ω–æ —á—Ç–æ –∫–ª–∏–∫–∞–µ—Ç—Å—è */
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
}
    
#bigHeartInner {
    display: inline-block;
}

.pulseNow {
    animation: pulseOnly 0.8s ease-in-out;
}

@keyframes pulseOnly {
    0% { transform: scale(1); }
    50% { transform: scale(1.25); }
    100% { transform: scale(1); }
}
    

@keyframes spinHeart {
    from { transform: translate(-50%, -50%) rotate(0deg); }
    to   { transform: translate(-50%, -50%) rotate(360deg); }
}

/* –≤–∑—Ä—ã–≤–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã */
.burst {
    position: fixed;
    left: 50%;
    top: 55%;
    font-size: 72px;
    pointer-events: none;
    z-index: 950;
    animation: burstFly 1.2s ease-out forwards;
}

@keyframes burstFly {
    from {
        transform: translate(-50%, -50%) scale(0.5);
        opacity: 1;
    }
    to {
        transform:
            translate(calc(-50% + var(--dx)),
                      calc(-50% + var(--dy)))
            scale(1.4);
        opacity: 0;
    }
}

/* –ª–µ—Ç—è—â–∏–µ —Å–µ—Ä–¥—Ü–∞ */
.heart {
    position: fixed;
    bottom: -20px;
    font-size: 26px;
    animation: fly 3s linear forwards;
}

@keyframes fly {
    to {
        transform: translateY(-110vh) rotate(360deg);
        opacity: 0;
    }
}

.heart, .burst, #bigHeart {
    font-family: "Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
}

#sidePanel {
    position: fixed;
    top: 0;
    right: -300px; /* —Å–∫—Ä—ã—Ç–∞ –∑–∞ —ç–∫—Ä–∞–Ω–æ–º */
    width: 300px;
    height: 100%;
    background: rgba(255,255,255,0.9);
    color: #b3002d;
    padding: 20px;
    box-shadow: -4px 0 20px rgba(0,0,0,0.3);
    transition: right 0.4s ease;
    overflow-y: auto;
    z-index: 1200;
    font-size: 18px;
    line-height: 1.5;
}

/* –∫–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å */
#panelBtn {
    position: fixed;
    top: 50%;
    right: 0;
    transform: translateY(-50%);
    background: #ff4b6e;
    color: white;
    border-radius: 8px 0 0 8px;
    padding: 12px 18px;
    cursor: pointer;
    z-index: 1300;
    font-size: 20px;
}

/* –ø–∞–Ω–µ–ª—å –æ—Ç–∫—Ä—ã—Ç–∞ */
#sidePanel.open { right: 0; }

#player {
    margin-top: 15px;
    padding: 12px;
    background: rgba(255,255,255,0.6);
    border-radius: 12px;
    text-align: center;
}

#trackName {
    font-weight: bold;
    margin-bottom: 8px;
    font-size: 16px;
}

.playerBtns button {
    font-size: 20px;
    padding: 8px 12px;
    margin: 4px;
    background: #ff4b6e;
    color: white;
    border-radius: 10px;
}

#title span {
  display: inline-block;
  animation: bounce 1s infinite;
}

@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-8px); }
}

/* –≤–æ–ª–Ω–æ–æ–±—Ä–∞–∑–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –±—É–∫–≤—ã */
#title span:nth-child(1) { animation-delay: 0s; }
#title span:nth-child(2) { animation-delay: 0.05s; }
#title span:nth-child(3) { animation-delay: 0.1s; }
#title span:nth-child(4) { animation-delay: 0.15s; }
#title span:nth-child(5) { animation-delay: 0.2s; }
#title span:nth-child(6) { animation-delay: 0.25s; }
#title span:nth-child(7) { animation-delay: 0.3s; }
#title span:nth-child(8) { animation-delay: 0.35s; }
#title span:nth-child(9) { animation-delay: 0.4s; }
#title span:nth-child(10) { animation-delay: 0.45s; }
#title span:nth-child(11) { animation-delay: 0.5s; }
#title span:nth-child(12) { animation-delay: 0.55s; }
#title span:nth-child(13) { animation-delay: 0.6s; }
#title span:nth-child(14) { animation-delay: 0.65s; }
#title span:nth-child(15) { animation-delay: 0.7s; }
#title span:nth-child(16) { animation-delay: 0.75s; }
#title span:nth-child(17) { animation-delay: 0.8s; }
#title span:nth-child(18) { animation-delay: 0.85s; }
#title span:nth-child(19) { animation-delay: 0.9s; }
#title span:nth-child(20) { animation-delay: 0.95s; }
#title span:nth-child(21) { animation-delay: 1s; }
#title span:nth-child(22) { animation-delay: 1.05s; }
#title span:nth-child(23) { animation-delay: 1.1s; }
#title span:nth-child(24) { animation-delay: 1.15s; }
#title span:nth-child(25) { animation-delay: 1.2s; }
#title span:nth-child(26) { animation-delay: 1.25s; }
#title span:nth-child(27) { animation-delay: 1.3s; }

#volumeSlider {
    width: 80%;            /* –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ø–æ–ª–æ—Å–∞ */
    height: 8px;            /* —Ç–æ–ª—â–∏–Ω–∞ */
    border-radius: 5px;
    background: #ddd;       /* —Ü–≤–µ—Ç –¥–æ—Ä–æ–∂–∫–∏ */
    accent-color: #ff4b6e;  /* —Ü–≤–µ—Ç –±–µ–≥—É–Ω–∫–∞ */
    cursor: pointer;
    margin-top: 5px;
}
    
#timeSlider {
    width: 200px;
    height: 8px;
    border-radius: 5px;
    background: #ddd;
    accent-color: #ff4b6e;
    cursor: pointer;
}
#currentTime, #totalTime {
    font-size: 13px;
    color: #333;
}

#speedSlider, #freqSlider {
    width: 200px;
    height: 8px;
    border-radius: 5px;
    background: #ddd;
    accent-color: #ff4b6e;
    cursor: pointer;
}


</style>
</head>

<body>

<div class="container">

<h1 id="title">
  <span>–ë</span><span>—É</span><span>–¥</span><span>–µ</span><span>—à</span> 
  <span>–ª</span><span>–∏</span> 
  <span>—Ç</span><span>—ã</span> 
  <span>–º</span><span>–æ</span><span>–∏</span><span>–º</span> 
  <span>–≤</span><span>–∞</span><span>–ª</span><span>–µ</span><span>–Ω</span><span>—Ç</span><span>–∏</span><span>–Ω</span><span>–æ</span><span>–º</span>?
  <span>‚ù§Ô∏è</span>
</h1>


<img id="jerboa1" class="gif" src="jerboa-jerboanils.gif">
<img id="jerboa2" class="gif" src="baby-jerboa-jerboa.gif" style="display:none;">

<div class="buttons" id="buttons">
    <button id="yesBtn">–î–ê üíñ</button>
    <button id="noBtn">–ù–ï–¢(</button>
</div>

</div>

<div id="bigHeart">
    <span id="bigHeartInner">‚ù§Ô∏è</span>
</div>

<div id="message">
    –£—Ä–∞–∞–∞!! üíò<br>
    –¢—É—à–∫–∞–Ω—á–∏–∫ –æ–¥–æ–±—Ä–∏–ª –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ!
</div>

<audio id="music"></audio>

<!-- –∫–Ω–æ–ø–∫–∞ –ø–∞–Ω–µ–ª–∏ -->
<div id="panelBtn">‚ÑπÔ∏è</div>
<!-- —Å–∞–º–∞ –ø–∞–Ω–µ–ª—å -->
<div id="sidePanel">
    <h2>–°–µ–∫—Ä–µ—Ç–Ω–∞—è –ø–∞–Ω–µ–ª—å üíå</h2>
    <p>–ú–æ–ª–æ–¥–µ—Ü, —Ç—ã –Ω–∞—à–ª–∞ —Å–∫—Ä—ã—Ç–æ–µ –ø–æ—Å–ª–∞–Ω–∏–µ!1!</p>
    <p>–•–æ—á—É —Å–∫–∞–∑–∞—Ç—å, —á—Ç–æ —è –æ—á–µ–Ω—å –±–ª–∞–≥–æ–¥–∞—Ä–µ–Ω —Ç–µ–±–µ –∑–∞ —Ç–µ–±—è. –¢—ã –ª—É—á—à–µ–µ –≤ –º–æ–µ–π –∂–∏–∑–Ω–∏ –∏ —è –æ—á–µ–Ω—å —Å–∏–ª—å–Ω–æ —Ç–µ–±—è –ª—é–±–ª—é, –ú–∞–Ω—è</p>
    <p>–°–ø–∞—Å–∏–±–æ –±–æ–ª—å—à–æ–µ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</p>

    <hr>

    <h3>–ú—É–∑—ã–∫–∞</h3>
    <div id="player">
        <div id="trackName">‚Äî</div>
        <div class="playerBtns">
            <button id="prevBtn">‚èÆ</button>
            <button id="stopBtn">‚èπ</button>
            <button id="nextBtn">‚è≠</button>

            <canvas id="visualizer" width="280" height="80" style="margin-top: 10px; border-radius:12px; background: rgba(0,0,0,0.1);"></canvas>
            
            <div id="timeContainer" style="display: flex; align-items: center; justify-content: center; margin-top: 10px; gap: 10px;">
                <span id="currentTime">0:00</span>
                <input type="range" id="timeSlider" min="0" max="100" value="0">
                <span id="totalTime">0:00</span>
            </div>
            <div style="margin-top:10px;">
                <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="1">
            </div>
        </div>
    </div>

    <hr>
    
    <h3>–≠—Ñ—Ñ–µ–∫—Ç—ã </h3>
    <div id="effectsControl" style="text-align: center; margin-top: 10px;">
    
        <div style="margin-bottom: 10px;">
            <label for="speedSlider">–°–∫–æ—Ä–æ—Å—Ç—å —Å–µ—Ä–¥–µ—Ü: <span id="speedVal">1.0x</span></label><br>
            <input type="range" id="speedSlider" min="0.2" max="3" step="0.1" value="1">
        </div>
    
        <div style="margin-bottom: 10px;">
            <label for="freqSlider">–ß–∞—Å—Ç–æ—Ç–∞ –ø–æ—è–≤–ª–µ–Ω–∏—è: <span id="freqVal">80</span> –º—Å</label><br>
            <input type="range" id="freqSlider" min="20" max="200" step="5" value="80">
        </div>
    
    </div>
    
</div>
    
<script>
let yesSize = 20;
let noSize = 12;
let clicks = 0;
let heartInterval = null;

const yesBtn = document.getElementById("yesBtn");
const noBtn = document.getElementById("noBtn");
const message = document.getElementById("message");
const music = document.getElementById("music");

const jerboa1 = document.getElementById("jerboa1");
const jerboa2 = document.getElementById("jerboa2");

const title = document.getElementById("title");
const buttons = document.getElementById("buttons");
const bigHeart = document.getElementById("bigHeart");

const bigHeartInner = document.getElementById("bigHeartInner");

sidePanel.style.display = "none";
panelBtn.style.display = "none";

/* –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ —Å–µ—Ä–¥—Ü–∞ */
let heartSpeedFactor = 1; // –º–Ω–æ–∂–∏—Ç–µ–ª—å —Å–∫–æ—Ä–æ—Å—Ç–∏ –¥–ª—è –Ω–æ–≤—ã—Ö —Å–µ—Ä–¥–µ—Ü

// –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ—Ä–¥—Ü–∞
function spawnHeart() {
    const heart = document.createElement("div");
    heart.className = "heart";
    heart.innerHTML = "‚ù§Ô∏è";
    heart.style.left = Math.random() * 100 + "vw";
    heart.style.fontSize = (20 + Math.random()*30) + "px";
    heart.style.animationDuration = (3 / heartSpeedFactor) + "s"; // —Å–∫–æ—Ä–æ—Å—Ç—å –∑–∞–¥–∞—ë–º –∑–¥–µ—Å—å
    document.body.appendChild(heart);
    setTimeout(() => heart.remove(), 3000 / heartSpeedFactor);
}

function startInfiniteHearts() {
    if (heartInterval) return;
    heartInterval = setInterval(spawnHeart, 40);
}

/* —Ç–µ–ª–µ–≥—Ä–∞–º-–≤–∑—Ä—ã–≤ */
function loveExplosion() {
    const effects = ["üíñ","üíò","üíû","‚ú®","‚ù§Ô∏è‚Äçüî•","üíó","üåü","üíì"];

    for (let i = 0; i < 22; i++) {
        const el = document.createElement("div");
        el.className = "burst";
        el.textContent = effects[Math.floor(Math.random()*effects.length)];

        const angle = Math.random() * Math.PI * 2;
        const dist = 200 + Math.random()*180;

        el.style.setProperty("--dx", Math.cos(angle)*dist + "px");
        el.style.setProperty("--dy", Math.sin(angle)*dist + "px");

        document.body.appendChild(el);
        setTimeout(() => el.remove(), 1200);
    }
}

/* –∫–Ω–æ–ø–∫–∞ –î–ê */
yesBtn.onclick = () => {

    startInfiniteHearts();
    music.play().catch(()=>{});

    jerboa1.style.display = "none";
    jerboa2.style.display = "inline-block";
    jerboa2.classList.add("jumpLoop");

    title.style.display = "none";
    buttons.style.display = "none";

    bigHeart.style.display = "block";
    message.style.display = "block";

    loveExplosion();
};

/* –∫–Ω–æ–ø–∫–∞ –ù–ï–¢ */
noBtn.onclick = () => {
    yesSize += 6;
    noSize -= 3;
    yesBtn.style.fontSize = yesSize + "px";
    noBtn.style.fontSize = Math.max(noSize, 8) + "px";
};

bigHeart.onclick = () => {
    clicks++;
    
    if(clicks === 7) {
        alert("–ö–∞–∫ —Ç—ã —ç—Ç–æ –Ω–∞—à–ª–∞?");
        panelBtn.style.display = "block";
        sidePanel.style.display = "block";
    }
    
    loveExplosion();        // —ç–º–æ–¥–∑–∏ –≤–∑—Ä—ã–≤
    spawnHeart();           // –µ—â—ë —Å–µ—Ä–¥—Ü–µ
    startInfiniteHearts();  // –ø–æ—Ç–æ–∫ —Å–µ—Ä–¥–µ—Ü

    /* –ø—É–ª—å—Å –±–µ–∑ —Å–±—Ä–æ—Å–∞ –≤—Ä–∞—â–µ–Ω–∏—è */
    bigHeartInner.classList.add("pulseNow");
    setTimeout(() => {
        bigHeartInner.classList.remove("pulseNow");
    }, 800);
};

const speedSlider = document.getElementById("speedSlider");
const speedVal = document.getElementById("speedVal");
const freqSlider = document.getElementById("freqSlider");
const freqVal = document.getElementById("freqVal");

// –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∞–Ω–∏–º–∞—Ü–∏–∏ —Å–µ—Ä–¥–µ—Ü
speedSlider.oninput = () => {
    heartSpeedFactor = parseFloat(speedSlider.value);
    speedVal.textContent = heartSpeedFactor.toFixed(1) + "x";
    
    document.querySelectorAll('.heart').forEach(h => {
        const elapsed = parseFloat(getComputedStyle(h).animationDuration) || 3;
        h.style.animationDuration = (3 / heartSpeedFactor) + "s";
    });
};

// –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —á–∞—Å—Ç–æ—Ç—ã –ø–æ—è–≤–ª–µ–Ω–∏—è —Å–µ—Ä–¥–µ—Ü
freqSlider.oninput = () => {
    freqVal.textContent = freqSlider.value;
    clearInterval(heartInterval);
    heartInterval = setInterval(spawnHeart, parseInt(freqSlider.value));
};


function spawnJerboa() {
    const clone = document.createElement("img");
    clone.src = "baby-jerboa-jerboa.gif"; // —Ç–æ—Ç –∂–µ GIF, —á—Ç–æ –∏ —É –≤—Ç–æ—Ä–æ–≥–æ —Ç—É—à–∫–∞–Ω—á–∏–∫–∞
    clone.className = "gif jumpLoop";
    
    // —Å–ª—É—á–∞–π–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è –Ω–∞ —ç–∫—Ä–∞–Ω–µ
    const left = Math.random() * (window.innerWidth - 100);
    const top = Math.random() * (window.innerHeight - 100);
    clone.style.position = "fixed";
    clone.style.left = left + "px";
    clone.style.top = top + "px";
    clone.style.width = "150px"; // –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –º–µ–Ω—å—à–µ
    clone.style.borderRadius = "20px";

    document.body.appendChild(clone);
}

jerboa2.onclick = () => {
    spawnJerboa();      // —Ä–∞–∑–º–Ω–æ–∂–µ–Ω–∏–µ —Ç—É—à–∫–∞–Ω–æ–≤
    loveExplosion();    // –≤–∑—Ä—ã–≤ —ç–º–æ–¥–∑–∏
    spawnHeart();       // —Å–µ—Ä–¥–µ—á–∫–∏
    startInfiniteHearts();
};

/* –æ—Ç–∫—Ä—ã—Ç—å / –∑–∞–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å */
panelBtn.onclick = () => {
    sidePanel.classList.toggle("open");
};

/* ===== –ü–õ–ï–ï–† ===== */

const tracks = [
    { name: "Push The Feeling on (short)", file: "music.mp3" },
    { name: "Versatile hardstyle", file: "music2.mp3" },
    { name: "Red", file: "music3.mp3" },
    { name: "I was made for Loving You", file: "music4.mp3" },
    { name: "My woman", file: "music5.mp3" }
];

let currentTrack = 0;

const trackNameEl = document.getElementById("trackName");
const prevBtn = document.getElementById("prevBtn");
const stopBtn = document.getElementById("stopBtn");
const nextBtn = document.getElementById("nextBtn");

function loadTrack(i) {
    currentTrack = (i + tracks.length) % tracks.length;
    music.src = tracks[currentTrack].file;
    trackNameEl.textContent = tracks[currentTrack].name;
}

function playCurrent() {
    music.play().catch(()=>{});
    stopBtn.textContent = "‚è∏";
}

prevBtn.onclick = () => {
    loadTrack(currentTrack - 1);
    playCurrent();
};

nextBtn.onclick = () => {
    loadTrack(currentTrack + 1);
    playCurrent();
};

stopBtn.onclick = () => {
    if (music.paused) {
        music.play().catch(()=>{});
        stopBtn.textContent = "‚è∏";
    } else {
        music.pause();
        stopBtn.textContent = "‚ñ∂";
    }
};


/* ===== –í–ò–ó–£–ê–õ–ò–ó–ê–¢–û–† ===== */
const canvas = document.getElementById("visualizer");
const ctx = canvas.getContext("2d");

const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
const analyser = audioCtx.createAnalyser();
const source = audioCtx.createMediaElementSource(music);

source.connect(analyser);
analyser.connect(audioCtx.destination);

analyser.fftSize = 64; // —á–µ–º –º–µ–Ω—å—à–µ, —Ç–µ–º –º–µ–Ω—å—à–µ –ø–æ–ª–æ—Å
const bufferLength = analyser.frequencyBinCount;
const dataArray = new Uint8Array(bufferLength);

function drawVisualizer() {
    requestAnimationFrame(drawVisualizer);

    analyser.getByteFrequencyData(dataArray);

    ctx.fillStyle = "rgba(255,255,255,0.1)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    const barWidth = canvas.width / bufferLength;
    let x = 0;
    const scale = 0.25;

    for(let i = 0; i < bufferLength; i++) {
        const barHeight = dataArray[i] * scale;
        ctx.fillStyle = `rgb(${255 - barHeight}, ${50 + barHeight}, 200)`;
        ctx.fillRect(x, canvas.height - barHeight, barWidth - 2, barHeight);
        x += barWidth;
    }
}

// –∑–∞–ø—É—Å–∫ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ –ø—Ä–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–∏
music.onplay = () => {
    if(audioCtx.state === "suspended") audioCtx.resume();
    drawVisualizer();
};

const volumeSlider = document.getElementById("volumeSlider");

// —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞—á–∞–ª—å–Ω–æ–π –≥—Ä–æ–º–∫–æ—Å—Ç–∏
music.volume = volumeSlider.value;

// –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–∑—É–Ω–∫–∞ –º–µ–Ω—è–µ–º –≥—Ä–æ–º–∫–æ—Å—Ç—å
volumeSlider.oninput = () => {
    music.volume = volumeSlider.value;
};

const timeSlider = document.getElementById("timeSlider");
const currentTimeEl = document.getElementById("currentTime");
const totalTimeEl = document.getElementById("totalTime");

// —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ–∫—É–Ω–¥ –≤ mm:ss
function formatTime(sec) {
    const minutes = Math.floor(sec / 60);
    const seconds = Math.floor(sec % 60);
    return `${minutes}:${seconds.toString().padStart(2, '0')}`;
}

// –∫–æ–≥–¥–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ç—Ä–µ–∫–∞ –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—â—É—é –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
music.onloadedmetadata = () => {
    totalTimeEl.textContent = formatTime(music.duration);
};

// –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é –∏ –ø–æ–ª–∑—É–Ω–æ–∫
music.ontimeupdate = () => {
    if (!timeSlider.dragging) {
        const value = (music.currentTime / music.duration) * 100 || 0;
        timeSlider.value = value;
        currentTimeEl.textContent = formatTime(music.currentTime);
    }
};

// –ø–µ—Ä–µ–º–æ—Ç–∫–∞ –ø—Ä–∏ —Ä—É—á–Ω–æ–º –¥–≤–∏–∂–µ–Ω–∏–∏ –ø–æ–ª–∑—É–Ω–∫–∞
timeSlider.oninput = () => {
    timeSlider.dragging = true;
    const time = (timeSlider.value / 100) * music.duration;
    currentTimeEl.textContent = formatTime(time);
};

timeSlider.onchange = () => {
    music.currentTime = (timeSlider.value / 100) * music.duration;
    timeSlider.dragging = false;
};


/* –∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é */
music.onended = () => {
    loadTrack(currentTrack + 1);
    playCurrent();
};

/* –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–µ—Ä–≤—ã–π —Ç—Ä–µ–∫ */
loadTrack(0);
stopBtn.textContent = "‚è∏";

</script>

</body>
    
</html>
